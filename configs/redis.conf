# 基础配置
port 6379
bind 127.0.0.1
timeout 0
tcp-keepalive 300

# 内存配置
maxmemory 256mb
maxmemory-policy allkeys-lru

# === 持久化配置（邮件队列专用） ===

# AOF持久化开启
appendonly yes
appendfilename "bmtdblog-appendonly.aof"

# 每秒同步一次（平衡安全性和性能）
appendfsync everysec

# 混合持久化（推荐）
aof-use-rdb-preamble yes

# AOF重写优化
no-appendfsync-on-rewrite yes
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# RDB快照配置
save 300 10    # 5分钟内有10个key变化就保存
save 60 1000   # 1分钟内有1000个key变化就保存

# RDB文件配置
dbfilename bmtdblog-dump.rdb
dir ./

# 持久化错误处理
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes

# === 日志配置 ===
loglevel notice
logfile "redis-bmtdblog.log"

# === 安全配置 ===
# requirepass your_password_here

# === 性能优化 ===
# 禁用一些不需要的功能
save ""  # 如果只用AOF可以禁用RDB

# 客户端连接
timeout 0
tcp-keepalive 300
maxclients 10000